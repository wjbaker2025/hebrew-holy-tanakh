<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tanakh Gematria Reader</title>
    <style>
        :root {
            --bg-color: #1e1e1e;
            --text-color: #e0e0e0;
            --sidebar-width: 250px;
            --accent-color: #0078d4; /* Windows 11 Blue */
            --highlight-color: #ffd700;
            --highlight-text: #000;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar - Books */
        #sidebar {
            width: var(--sidebar-width);
            background-color: #252526;
            border-right: 1px solid #333;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .tab-header {
            padding: 15px;
            font-weight: bold;
            background-color: #2d2d2d;
            border-bottom: 1px solid #333;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .book-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .book-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #2d2d2d;
            transition: background 0.2s;
        }

        .book-item:hover, .book-item.active {
            background-color: #37373d;
            border-left: 4px solid var(--accent-color);
        }

        /* Main Content */
        #main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        /* Top Bar - Gematria Tools */
        #top-bar {
            height: 70px;
            background-color: #2d2d2d;
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            padding: 0 20px;
            gap: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .search-group {
            display: flex;
            gap: 10px;
            flex: 1;
            max-width: 600px;
        }

        input[type="text"] {
            flex: 1;
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #444;
            background-color: #1e1e1e;
            color: white;
            font-size: 14px;
        }

        button {
            padding: 8px 16px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }

        button:hover {
            opacity: 0.9;
        }

        .gematria-display {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #aaa;
        }

        .gematria-value {
            color: var(--highlight-color);
            font-weight: bold;
        }

        /* Reader Area */
        #reader-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px 40px;
            scroll-behavior: smooth;
        }

        /* Navigation Controls */
        #nav-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 40px;
            background-color: #252526;
            border-top: 1px solid #333;
        }

        /* Bible Text Layout */
        .chapter-title {
            font-size: 2em;
            margin-bottom: 20px;
            border-bottom: 1px solid #444;
            padding-bottom: 10px;
        }

        .verse-container {
            margin-bottom: 25px;
            display: flex;
            flex-wrap: wrap;
            align-items: flex-start;
            gap: 15px;
            line-height: 1.6;
        }

        .verse-number {
            font-weight: bold;
            color: var(--accent-color);
            margin-right: 5px;
            font-size: 0.9em;
            user-select: none;
        }

        /* Word Cards */
        .word-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 4px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .word-hebrew {
            font-family: 'Ezra SIL', 'Times New Roman', serif;
            font-size: 1.4em;
            direction: rtl;
            margin-bottom: 2px;
        }

        .word-english {
            font-size: 0.85em;
            color: #aaa;
            text-align: center;
        }

        /* Highlighting Logic */
        .word-card.imprinted {
            background-color: var(--highlight-color);
        }
        
        .word-card.imprinted .word-english {
            color: var(--highlight-text);
            font-weight: bold;
        }
        
        .word-card.imprinted .word-hebrew {
            color: var(--highlight-text);
        }

    </style>
</head>
<body>

    <div id="sidebar">
        <div class="tab-header">Tanakh Books</div>
        <ul class="book-list" id="book-list">
            <li class="book-item active" onclick="loadBook('Genesis')">Genesis</li>
            <li class="book-item" onclick="alert('Connect full data source to load Exodus')">Exodus</li>
            <li class="book-item" onclick="alert('Connect full data source to load Leviticus')">Leviticus</li>
        </ul>
    </div>

    <div id="main-content">
        <div id="top-bar">
            <div class="search-group">
                <input type="text" id="gematria-search" placeholder="Search word (e.g., Elohim, God) to imprint..." onkeypress="handleEnter(event)">
                <button onclick="imprintGematria()">Imprint</button>
            </div>
            <div class="gematria-display" id="gematria-result">
                Value: <span class="gematria-value">0</span> (Biblical)
            </div>
        </div>

        <div id="reader-container">
            <div id="bible-text">
                </div>
        </div>

        <div id="nav-controls">
            <button onclick="prevChapter()">← Previous Page</button>
            <span id="current-location">Genesis 1</span>
            <button onclick="nextChapter()">Next Page →</button>
        </div>
    </div>

    <script>
        // --- 1. CONFIGURATION & DATA ---
        let currentBook = "Genesis";
        let currentChapter = 1;
        let activeSearchTerm = "";
        
        // Embedded DEMO Data (Genesis Ch 1 truncated for brevity, acts as fallback)
        // In a real scenario, this fetches from your JSON files.
        const bibleData = {
            "Genesis": {
                "chapters": {
                    "1": {
                        "1": [
                            {"hebrew": "בְּרֵאשִׁ֖ית", "english": "In the beginning"},
                            {"hebrew": "בָּרָ֣א", "english": "created"},
                            {"hebrew": "אֱלֹהִ֑ים", "english": "God"},
                            {"hebrew": "אֵ֥ת", "english": "-"},
                            {"hebrew": "הַשָּׁמַ֖יִם", "english": "the heavens"},
                            {"hebrew": "וְאֵ֥ת", "english": "and"},
                            {"hebrew": "הָאָֽרֶץ׃", "english": "the earth"}
                        ],
                        "2": [
                            {"hebrew": "וְהָאָ֗רֶץ", "english": "And the earth"},
                            {"hebrew": "הָיְתָ֥ה", "english": "was"},
                            {"hebrew": "תֹ֙הוּ֙", "english": "formless"},
                            {"hebrew": "וָבֹ֔הוּ", "english": "and void"},
                            {"hebrew": "וְחֹ֖שֶׁךְ", "english": "and darkness"},
                            {"hebrew": "עַל־", "english": "over"},
                            {"hebrew": "פְּנֵ֣י", "english": "the face"},
                            {"hebrew": "תְה֑וֹם", "english": "of the deep"}
                        ]
                    },
                    "2": {
                        "1": [
                            {"hebrew": "וַיְכֻלּ֛וּ", "english": "Thus were finished"},
                            {"hebrew": "הַשָּׁמַ֥יִם", "english": "the heavens"},
                            {"hebrew": "וְהָאָ֖רֶץ", "english": "and the earth"}
                        ]
                    }
                }
            }
        };

        // --- 2. GEMATRIA ENGINE ---
        // Simple mapping based on your definition file (Biblical Cipher)
        const gematriaMap = {
            'א':1, 'ב':2, 'ג':3, 'ש':3, 'ד':4, 'ת':4, 'ה':5, 
            'ו':6, 'ז':7, 'ח':8, 'ט':9, 'י':10, 'כ':20, 'ך':20,
            'ל':30, 'מ':40, 'ם':40, 'נ':50, 'ן':50, 'ס':60, 
            'ע':70, 'פ':80, 'ף':80, 'צ':90, 'ץ':90, 'ק':100, 'ר':200
        };

        function calculateGematria(text) {
            if (!text) return 0;
            // Clean non-hebrew chars usually, but here we just sum known chars
            let sum = 0;
            for (let char of text) {
                if (gematriaMap[char]) {
                    sum += gematriaMap[char];
                }
            }
            return sum;
        }

        // --- 3. APP LOGIC ---

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Check if we can fetch real files (Local Server Mode)
            // If not, use embedded demo data
            fetchData();
        });

        async function fetchData() {
            try {
                // Attempt to fetch the user's actual file structure
                const response = await fetch('Tanakh/1. Torah - Instructions/01_genesis.json');
                if (response.ok) {
                    const data = await response.json();
                    bibleData["Genesis"] = data["Genesis"]; // Overlay real data
                }
            } catch (e) {
                console.log("Using demo data (Use the PowerShell script to load local files)");
            }
            renderPage();
        }

        function renderPage() {
            const container = document.getElementById('bible-text');
            const chapters = bibleData[currentBook]?.chapters;
            
            if (!chapters || !chapters[currentChapter]) {
                container.innerHTML = `<div style="padding:20px;">End of available text or Chapter ${currentChapter} not found.</div>`;
                return;
            }

            const versesObj = chapters[currentChapter];
            let html = `<div class="chapter-title">${currentBook} Chapter ${currentChapter}</div>`;

            // Sort verses just in case keys are unordered
            const verseKeys = Object.keys(versesObj).sort((a,b) => parseInt(a) - parseInt(b));

            verseKeys.forEach(vNum => {
                const words = versesObj[vNum];
                html += `<div class="verse-container"><span class="verse-number">${vNum}</span>`;
                
                words.forEach(word => {
                    const isMatch = checkMatch(word);
                    const highlightClass = isMatch ? 'imprinted' : '';
                    
                    html += `
                        <div class="word-card ${highlightClass}">
                            <div class="word-hebrew">${word.hebrew || ""}</div>
                            <div class="word-english">${word.english || "-"}</div>
                        </div>
                    `;
                });
                
                html += `</div>`;
            });

            container.innerHTML = html;
            document.getElementById('current-location').innerText = `${currentBook} ${currentChapter}`;
        }

        function checkMatch(wordObj) {
            if (!activeSearchTerm) return false;
            const term = activeSearchTerm.trim().toLowerCase();
            const eng = (wordObj.english || "").toLowerCase();
            const heb = (wordObj.hebrew || "");
            
            // Simple string matching
            // Remove cantillation marks from hebrew for better matching if needed
            // For now, strict match
            return eng.includes(term) || heb.includes(term);
        }

        function imprintGematria() {
            const input = document.getElementById('gematria-search');
            activeSearchTerm = input.value;
            
            // Calculate Value (If hebrew is entered)
            const val = calculateGematria(activeSearchTerm);
            document.getElementById('gematria-result').innerHTML = 
                `Value: <span class="gematria-value">${val > 0 ? val : 'N/A'}</span> (Biblical)`;

            // Re-render to apply highlights
            renderPage();
        }

        function handleEnter(e) {
            if (e.key === 'Enter') imprintGematria();
        }

        // Navigation
        function nextChapter() {
            currentChapter++;
            renderPage();
            document.getElementById('reader-container').scrollTop = 0;
        }

        function prevChapter() {
            if (currentChapter > 1) {
                currentChapter--;
                renderPage();
                document.getElementById('reader-container').scrollTop = 0;
            }
        }

        function loadBook(bookName) {
            currentBook = bookName;
            currentChapter = 1;
            // Update active sidebar tab
            document.querySelectorAll('.book-item').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
            renderPage();
        }

    </script>
</body>
</html>
